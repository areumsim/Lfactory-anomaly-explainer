# Local 이상 탐지에서의 "Local"

**버전**: 1.0
**최종 업데이트**: 2025-10-01
**상태**: 초기 정의 (문헌 조사로 확장 예정)

---

## 요약

이 프로젝트에서 "Local"은 시스템의 범위와 배포 모델을 함께 정의하는 **세 가지 상호 연결된 의미**를 갖습니다. 이 문서는 재현성을 보장하고 연구 커뮤니케이션에서 모호성을 방지하기 위해 용어를 명확히 합니다.

---

## 1. 정의: "Local"의 세 가지 차원

### 1.1 데이터/프로세스 특화 적응 (주요 의미)

**정의**: 이상 탐지 규칙, 임계값, 모델이 범용적이지 않고 **데이터셋 또는 제조 프로세스별로 특화**됩니다.

**근거**:
- 제조 환경은 이질적 (예: 밸브 모니터링 vs 모터 진동 vs 화학 센서)
- 혼합 데이터로 학습된 "전역(global)" 만능 모델은 성능이 낮음
- **Local 적응**의 의미:
  - 프로세스별로 다른 비용 행렬 (FN/FP 비율이 중요도에 따라 다름)
  - 데이터셋별 임계값 (SKAB 밸브 ≠ SMD 서버 메트릭)
  - 프로세스 인식 특징 선택 (주기적 기계는 주파수 특징, 일시적 고장은 시간 도메인)

**예시**:
- **전역 접근** (이 프로젝트 아님): 모든 제조 데이터로 단일 LSTM-AE 학습, 보편적 적용
- **Local 접근** (이 프로젝트): 데이터셋별 학습/튜닝; SKAB는 임계값=3.5인 robust z-score 사용, SMD는 k=15인 kNN 사용

**연구 함의**:
- RQ4 (비용 민감성)는 데이터셋 특성(불균형, SNR)별로 비용 행렬을 **어떻게** local하게 적응시킬지 조사
- 보정 파라미터 (Platt A/B, Isotonic bins)는 데이터셋별로 적합

---

### 1.2 온프레미스 배포 가능 (부차적 의미)

**정의**: 시스템이 클라우드 전용이 아닌 **local (온프레미스) 인프라**에서 실행 가능합니다.

**근거**:
- 제조 데이터는 종종 독점 프로세스 파라미터 포함 → 개인정보/IP 우려
- 일부 환경은 에어갭(air-gapped) (국방, 제약 클린룸)
- 실시간 제약 (밀리초 지연) → 엣지/local 배포 선호

**구현**:
- **Local EXAONE 모델** (Phase 2): LLM이 local GPU에서 실행 (우리 설정에서 `cuda:3`)
  - 설명 생성을 위한 외부 API 호출 없음
  - 모델 가중치가 local NAS에 저장 (`/workspace/data2_/nas_kbn02_02/models/...`)
- 민감하지 않은 연구 실험을 위한 **선택적 OpenAI**
- 모든 핵심 탐지 (Phase 1)가 Python 3.9+ stdlib 외에 **외부 의존성 0**

**대비**:
- **클라우드 전용**: 분석을 위해 시계열을 AWS/Azure로 전송 (이 프로젝트 아님)
- **Local/Hybrid**: Local에서 탐지, 선택적으로 local LLM 또는 클라우드 API를 통해 설명 (이 프로젝트)

---

### 1.3 문맥-Local 탐지 (기술적 의미)

**정의**: 이상 탐지가 전역/집합 패턴이 아닌 **local 시간 윈도우 문맥** (포인트 단위 또는 짧은 세그먼트)에서 작동합니다.

**기술적 세부사항**:
- **포인트 단위 이상**: local 이웃 `[t-w, t+w]`가 주어졌을 때 단일 타임스탬프 `t`에서 비정상적인 값
  - 예: t=1000에서의 스파이크가 주변 기준선 대비 이상
- **세그먼트-local**: 짧은 연속 이상 (계단 변화, 10-50 포인트에 걸친 드리프트)

**다른 이상 유형과의 대비** (이 프로젝트의 초점 아님):
- **전역 이상**: 전체 시계열 분포 이동 (예: 계절 패턴 변화) → 문맥적 이상 탐지
- **집합 이상**: 패턴이 그룹으로만 비정상 (예: 시퀀스 "A-B-C"가 개별적으로는 정상, 함께는 비정상) → 시퀀스 마이닝

**프로젝트 범위**:
- 다음을 사용하여 **local** 스파이크, 계단, 드리프트를 탐지:
  - Rolling z-score (기본 local 윈도우=50)
  - 값 공간의 kNN (local 밀도)
  - 주파수 밴드 (local STFT 윈도우=128)
- 전역 계절 변화나 집합 순차 패턴은 탐지하지 **않음** (현재)

**향후 확장** (Phase 1 범위 밖):
- 집합 이상 탐지는 시퀀스 모델 (HMM, LSTM) 필요 → Phase 3 고려사항

---

## 2. "LLM-Guided"와의 관계

LLM (Phase 2)은 RAG를 통해 **local 적응 가이드**를 제공합니다:

1. **프로세스 특화 규칙**: 현재 데이터셋/프로세스와 관련된 문서 검색
   - 쿼리: "고불균형 데이터셋에 어떤 비용 행렬?"
   - 검색됨: EVALUATION_PROTOCOL.md의 비용 민감 임계값 설정 섹션
   - LLM 제안: "불균형 >0.1인 경우, FN 비용을 FP의 10배로 증가"

2. **임계값 조정**: local 문맥별로 임계값 권장
   - SKAB 밸브 데이터가 낮은 SNR이면 → robust z-score 제안
   - AIHub 데이터에 드리프트 있으면 → SpecCNN (주파수 특징) 제안

3. **온프레미스 LLM**: Local EXAONE 모델이 개인정보 보호 local 배포 보장

**아님**:
- LLM이 모든 데이터셋에 걸쳐 전역 최적화를 수행하지 **않음**
- LLM이 보편적 모델을 학습하지 **않음**
- LLM이 **local, 데이터셋 인식** 권장사항 제공

---

## 3. 명확화: "Local"이 의미하지 **않는** 것

혼란을 방지하기 위해, 명시적으로 **제외된** 의미:

### ❌ "지역화된(Localized)" (지리적) 아님
- **아님**: 공장 위치별 다른 배포 (서울 vs 울산)
- **맞음**: 프로세스 유형별 다른 구성 (밸브 vs 모터)

### ❌ "지역 변수(Local Variable)" (프로그래밍) 아님
- **아님**: 코드의 변수 범위
- **맞음**: 모델 적용 가능성의 범위

### ❌ "Locality-Sensitive Hashing" 아님
- **아님**: 특정 알고리즘 (최근접 이웃 탐색을 위한 LSH)
- **맞음**: 설계 철학 (local하게 적응)

---

## 4. 정당화 및 문헌

### 4.1 제조에서 "Local"이 중요한 이유

**문제**: 제조 데이터 이질성
- Katser & Kozitsin (2020, SKAB 데이터셋 논문): "다른 고장 모드는 다른 탐지 전략 필요"
- 도메인 전문지식: 밸브 고장 ≠ 모터 진동 ≠ 온도 드리프트
- **증거**: 우리의 절제 연구(RQ1)는 SpecCNN이 SKAB (주기적)에서 우수, SMD (비주기적)에서 실패함을 보임

**해결책**: Local 적응
- 앙상블 가중치 (RQ2): α가 데이터셋별로 다름
- 비용 행렬 (RQ4): FN/FP 비율이 프로세스 중요도와 불균형에 의존
- 임계값: 분위수 기반, 데이터셋 분할별로 적합

### 4.2 온프레미스 요구사항

**출처** (산업 보고서로 확장 예정):
- 제조 IT 조사 (플레이스홀더): 공장의 68%가 프로덕션 중요 센서의 클라우드 데이터 업로드 금지
- 데이터 거주 규정: EU GDPR, 한국 PIPA → local 저장 의무화

**구현 선택**:
- Local EXAONE 모델 (7.8B–32B 파라미터) 단일 GPU에서 달성 가능
- 트레이드오프: 더 작은 모델 vs 데이터 개인정보
- 민감하지 않은 연구 벤치마킹 전용 OpenAI 옵션

### 4.3 포인트 단위 vs 집합 (문헌 조사 - TODO)

**Chandola et al. (2009)**: Anomaly Detection: A Survey
- 포인트 이상: "단일 데이터 인스턴스가 데이터의 나머지와 대비하여 이상"
- 문맥적 이상: "특정 문맥에서 이상이지만 그렇지 않으면 정상"
- 집합 이상: "데이터 인스턴스의 집합이 이상"

**이 프로젝트**: **포인트** 및 **문맥적 (local-윈도우)** 이상에 초점

**추가 예정** (2주차):
- local vs 전역 이상 탐지에 관한 3-5편 논문
- 제조 특화 참고문헌

---

## 5. 재현성을 위한 운영 정의

실험 보고를 위해, "local" 파라미터는 다음을 포함:

| 파라미터 | 의미 | 예시 값 |
|-----------|---------|-------------------|
| `--dataset` | 데이터셋/프로세스 이름 | SKAB, SMD, AIHub71802 |
| `--split` | 데이터 분할 (train/test) | test |
| `--z-window` | Rule을 위한 Local 시간 윈도우 | 50 |
| `--ml-k` | kNN을 위한 Local 이웃 크기 | 10 |
| `--sc-window` | SpecCNN을 위한 Local STFT 윈도우 | 128 |
| `--costs` | Local 비용 행렬 | 0,1,5,0 (데이터셋별) |
| `--llm-provider` | Local 또는 클라우드 LLM | local_exaone_35_78b |

**재현성 요구사항**:
- 결과를 보고할 때, 모든 local 파라미터 명시
- 예: "SKAB 결과는 local z-window=50, costs=0,1,10,0 사용"

---

## 6. 연구 질문과의 관계

### RQ1 (주파수 vs 시간 특징)
- **Local**: local 윈도우에서 추출된 특징 (STFT window=128 vs rolling window=50)
- 데이터셋 특화: 최적 윈도우 크기가 다름

### RQ2 (앙상블 방법)
- **Local**: 데이터셋별로 적합된 앙상블 가중치 α
- 모든 데이터에 대한 단일 전역 α가 아님

### RQ3 (Point vs Event 메트릭)
- **Local**: Point-wise F1이 본질적으로 local (타임스탬프별)
- Event F1은 세그먼트-local (연속 이상 범위)

### RQ4 (비용 민감성)
- **Local**: 비용 행렬이 데이터셋/프로세스별로 다름
- 핵심 연구 질문: local 비용을 **어떻게** 설정할 것인가?

---

## 7. 향후 개선

### 2주차 (문헌 조사)
- [ ] "local anomaly detection" 용어에 관한 5-10편 논문 추가
- [ ] "프로세스 특화" vs "전역" 접근에 대한 제조 AD 논문 조사
- [ ] 산업 온프레미스 배포 통계 문서화

### Phase 2 (LLM 통합)
- [ ] RAG 검색이 프로세스 특화 문서 포함 (예: "SKAB 밸브 매뉴얼")
- [ ] LLM이 local 적응 제안: "이 밸브 유형에는 robust detection 사용"

### Phase 3 (향후)
- [ ] "local 설명 가능성"으로 확장: *이 특정 포인트*가 왜 이상인가?
- [ ] 다중 사이트 배포: 공장별 local 모델 + 연합 학습 (선택적)

---

## 8. 요약 표

| 차원 | 정의 | 주요 이점 | 구현 |
|-----------|------------|-------------|-------------------|
| **데이터/프로세스 특화** | 데이터셋별 적응 | 더 나은 정확도 | 데이터셋별 하이퍼파라미터, 비용 |
| **온프레미스** | Local에서 실행 | 개인정보, 지연 | Local EXAONE, 클라우드 의존성 0 |
| **문맥-Local** | 포인트/세그먼트 이상 | 실시간 탐지 | Rolling 윈도우, local 특징 |

---

## 참고문헌

1. Katser, I. D., & Kozitsin, V. (2020). Skoltech Anomaly Benchmark (SKAB). *arXiv preprint*.
2. Chandola, V., Banerjee, A., & Kumar, V. (2009). Anomaly detection: A survey. *ACM computing surveys*, 41(3), 1-58.
3. [2주차 문헌 조사로 확장 예정]

---

**부록 A: "이것이 Local인가?" 결정 트리**

```
방법/파라미터가 데이터셋 특화인가?
├─ 예 → Local (차원 1)
└─ 아니오 → 배포 확인
    ├─ 클라우드 없이 온프레미스에서 실행? → Local (차원 2)
    └─ 시간 윈도우 문맥에서 작동? → Local (차원 3)
```

---

**버전 히스토리**:
- 1.0 (2025-10-01): 초기 정의 (3차원)
- 1.1 (2주차 계획): 문헌 조사 확장
