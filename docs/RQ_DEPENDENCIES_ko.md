# 연구 질문 상호의존성 분석

**버전**: 1.0
**최종 업데이트**: 2025-10-01
**상태**: 초안 (2주차 실험 후 개선 예정)

---

## 요약

이 문서는 LFactory의 4개 연구 질문(RQ)이 독립적 기여가 아닌 통합된 연구 내러티브를 형성하며 **유기적으로 상호연결**되어 있는 방식을 분석합니다. 이러한 의존성을 이해하는 것은 다음에 중요합니다:
1. **실험 설계**: RQ 답변이 서로의 결과에 의존
2. **해석**: RQ1 문맥 없이 RQ2 해석 불가
3. **실용적 적용**: 실제 배포는 4개 RQ 모두 함께 답변 필요

---

## 1. 네 가지 연구 질문 (요약)

`TODO.md` Section 1.3에서:

- **RQ1** (특징 도메인): "주파수 도메인 특징(DFT 밴드)이 제조 스파이크/계단/드리프트 이상에 대해 시간 도메인 특징(rolling 통계)보다 우수한가?"

- **RQ2** (앙상블 방법): "어떤 앙상블 방법(선형, 곱, 최대, 학습)이 최상의 보정-비용 트레이드오프를 달성하는가?"

- **RQ3** (메트릭 상관관계): "탐지기에 걸쳐 포인트 단위 F1과 이벤트 단위 F1의 상관관계는 무엇인가?"

- **RQ4** (비용 민감성): "FN/FP 비용 비율이 데이터셋 불균형 및 SNR과 어떻게 달라져야 하는가?"

---

## 2. 쌍별 의존성

### 2.1 RQ1 → RQ2: 특징 도메인이 앙상블 설계에 영향

**의존성**: 최적 앙상블 방법(RQ2)이 어느 특징 도메인이 더 잘 수행하는지(RQ1)에 의존.

**메커니즘**:
- 주파수 특징(SpecCNN)이 데이터셋에서 시간 특징(Rule)을 지배하면(RQ1 답변: "주파수가 이김"), 그러면:
  - **선형 앙상블**은 SpecCNN에 더 높은 가중치 α 할당해야
  - **곱 앙상블**은 SpecCNN의 높은 신뢰도를 과도하게 증폭할 수 있음
  - **최대 앙상블**은 Rule을 완전히 무시할 수 있음
  - **학습된 앙상블**은 SpecCNN을 더 신뢰하도록 학습해야

**예시 시나리오**:
```
데이터셋: SKAB valve (주기적 진동)
RQ1 결과: SpecCNN AUC-PR = 0.85, Rule AUC-PR = 0.65 → 주파수가 이김

RQ2 함의:
- 선형 (α=0.7): 0.3×Rule + 0.7×SpecCNN → AUC-PR ≈ 0.80
- 곱: Rule^0.3 × SpecCNN^0.7 → 약 0.82일 수 있음 (Rule의 페널티 적음)
- 학습된: SpecCNN 가중치 ≈ 0.8을 자동 할당
```

**실험 프로토콜 결과**:
- 데이터셋별 RQ1이 답변될 때까지 RQ2 앙상블 방법 선택 최종화 불가
- RQ2 실험은 RQ1 결과별로 계층화되어야 (주파수 지배 vs 시간 지배 데이터셋)

**인용**: 이것은 level-0 모델 다양성에 level-1 모델 성능이 의존하는 **stacked generalization** (Wolpert, 1992)과 관련.

---

### 2.2 RQ2 → RQ3: 앙상블 방법이 Point/Event 메트릭 트레이드오프에 영향

**의존성**: 서로 다른 앙상블 방법(RQ2)이 포인트 단위 정밀도 vs 이벤트 단위 재현율(RQ3)로 편향될 수 있음.

**메커니즘**:
- **선형 앙상블**: 부드러운 점수 평균 → 고립된 거짓 양성 적음 → 높은 포인트 정밀도, 낮은 이벤트 재현율
- **최대 앙상블**: 최대 점수 취함 → 더 공격적 → 높은 이벤트 재현율, 낮은 포인트 정밀도
- **곱 앙상블**: 두 탐지기가 동의 필요 → 보수적 → 높은 포인트 정밀도, 낮은 이벤트 재현율
- **학습된 앙상블**: 학습 목적에 의존 (포인트 단위 손실로 학습되면, Point F1로 편향)

**예시 시나리오**:
```
탐지기: Hybrid (Rule + ML)
앙상블: 선형 α=0.5

Point F1: 0.72 (정밀하지만 보수적)
Event F1: 0.65 (평균된 낮은 점수로 일부 이벤트 놓침)

앙상블: 최대

Point F1: 0.68 (더 많은 거짓 양성)
Event F1: 0.78 (더 많은 이벤트 포착)
```

**실험 프로토콜 결과**:
- RQ3 상관관계 분석이 각 RQ2 앙상블 변형에 대해 반복되어야
- RQ3 산점도는 앙상블 방법별로 다른 색상을 가져야
- 어떤 앙상블을 지정하지 않고 "포인트와 이벤트 F1이 상관관계 있음" 주장 불가

**인용**: 임계값 선택에서의 정밀도-재현율 트레이드오프와 유사 (Davis & Goadrich, 2006).

---

### 2.3 RQ3 → RQ4: 메트릭 상관관계가 비용 행렬 설계에 영향

**의존성**: 포인트 F1과 이벤트 F1이 상관관계 없으면(RQ3 답변: "약한 상관관계"), 비용 행렬(RQ4)이 두 메트릭 모두 고려해야.

**메커니즘**:
- **높은 상관관계 (ρ > 0.8)**: 포인트 F1 최적화가 이벤트 F1도 최적화 → 단일 비용 행렬로 충분
- **낮은 상관관계 (ρ < 0.6)**: 한 메트릭 최적화가 다른 것 손상 → 비용 행렬이 우선시할 메트릭 결정 필요

**예시 시나리오**:
```
RQ3 결과: Point F1 vs Event F1 상관관계 = 0.45 (약함)

RQ4 함의:
- 제조 도메인이 이벤트 탐지 우선시(이벤트 놓침 = 치명적)하면:
  → 비용 행렬이 **이벤트 기반 FN 비용** 사용해야
  → C_FN = 10 × C_FP (놓친 이벤트에 높은 페널티)
  → 이벤트 재현율 최적화된 임계값, 낮은 포인트 정밀도 수용

- 제조 도메인이 낮은 거짓 경보율 우선시하면:
  → 비용 행렬이 **포인트 기반 FP 비용** 사용
  → C_FP = 5 × C_FN
  → 포인트 정밀도 최적화된 임계값, 놓친 이벤트 수용
```

**실험 프로토콜 결과**:
- RQ4 비용 민감도 분석이 포인트 최적 및 이벤트 최적 임계값 모두 보고해야
- 상관관계가 약하면, 두 동작 지점 권장: "고재현율 모드"와 "고정밀도 모드"
- `EVALUATION_PROTOCOL.md`에 문서화: "이벤트 탐지가 중요한 프로세스(예: 밸브 고장)에는 이벤트 최적화 비용 행렬(C_FN=10) 사용. 거짓 경보가 비싼 프로세스(예: 생산 라인 중단)에는 포인트 최적화 행렬(C_FP=5) 사용."

**인용**: 불균형 학습에서의 다목적 최적화 (Galar et al., 2011).

---

### 2.4 RQ4 → RQ1: 비용 민감성이 이상 유형 탐지에 의존

**의존성**: 최적 비용 비율(RQ4)이 어떤 특징이 어떤 이상 유형을 더 잘 탐지하는지(RQ1)에 의존.

**메커니즘**:
- **RQ1 발견**: 주파수 특징이 **드리프트**를 잘 탐지 (SNR-강건), 시간 특징이 **스파이크**를 잘 탐지 (local 민감도)
- **RQ4 비용 행렬**: **드리프트**를 놓치는 것이 더 비싸면(예: 점진적 장비 열화 → 비싼 고장), 그러면:
  - 드리프트 이상에 대한 FN 비용 증가
  - 앙상블 가중치를 주파수 특징(SpecCNN)쪽으로

**예시 시나리오**:
```
데이터셋: AIHub 화학 센서
이상 유형: 60% 드리프트, 40% 스파이크

RQ1 결과:
- 드리프트 탐지: SpecCNN F1 = 0.80, Rule F1 = 0.55
- 스파이크 탐지: SpecCNN F1 = 0.60, Rule F1 = 0.75

도메인 지식: 드리프트 → 장비 고장 (C_FN = $10,000)
              스파이크 → 일시적 노이즈 (C_FN = $100)

RQ4 비용 행렬 (빈도 × 심각도로 가중):
- 유효 C_FN = 0.6 × 10,000 + 0.4 × 100 = $6,040
- 드리프트 재현율 최적화 → SpecCNN 중심 앙상블 사용
```

**실험 프로토콜 결과**:
- RQ4 분석이 **이상 유형별로 계층화**되어야 (레이블이 유형 메타데이터 포함하면)
- RQ1이 특징 도메인 선호가 이상 유형별로 다름을 보이면, RQ4는 **이상 유형별 비용 행렬** 권장해야

**인용**: 능동 학습에서의 문맥 의존 비용 행렬 (Lowell et al., 2019).

---

## 3. 삼자 의존성

### 3.1 RQ1 + RQ2 + RQ4: 통합 비용 최적 탐지기

**연결**: 세 RQ 모두가 최종 질문에 수렴: **"예상 비용 최소화를 위한 최상의 탐지기 구성(특징 + 앙상블 + 임계값)은 무엇인가?"**

**워크플로우**:
1. **RQ1**: 데이터셋/이상 유형별로 어떤 특징이 최고 성능인지 결정
   - 출력: 특징 선호 행렬 `F[dataset, anomaly_type] → {time, freq, hybrid}`

2. **RQ2**: 보정과 비용의 균형을 맞추는 앙상블 방법 선택
   - 입력: RQ1의 특징 점수
   - 출력: 최적 앙상블 방법을 통한 결합 점수

3. **RQ4**: 데이터셋별 비용 행렬을 사용하여 임계값 설정
   - 입력: RQ2의 결합 점수
   - 출력: 비용 최적 임계값에서 이진 예측

**다이어그램**:
```
RQ1: 특징 선택              RQ2: 앙상블              RQ4: 임계값 설정
    ↓                              ↓                      ↓
시간 특징 (Rule) ──┐       선형: 0.3×R + 0.7×S     비용 행렬:
주파수 특징 (SpecCNN) ─→  →  곱: R^0.3 × S^0.7  → (0, 1, 10, 0)
    ↑                          최대: max(R, S)             임계값: τ*
데이터셋별 RQ1 결과         학습된: f(R, S)           예상 비용 ↓
```

**통합**:
- 최종 탐지기: `HybridCostOptimal(feature_domain=RQ1_answer, ensemble_method=RQ2_answer, cost_matrix=RQ4_answer)`
- **분리 불가**: 하나의 RQ 답변 변경이 다른 것들의 재평가 필요

---

### 3.2 RQ2 + RQ3 + RQ4: 메트릭 인식 비용 최적화

**연결**: 비용 최적화(RQ4)가 어떤 메트릭이 중요한지(RQ3)를 고려해야 하고, 앙상블 방법(RQ2)이 메트릭 트레이드오프에 영향.

**워크플로우**:
1. **RQ3**: 포인트 F1과 이벤트 F1이 상관관계 있는지 결정
   - **높은 상관관계**인 경우: 어느 메트릭으로든 최적화 (동일 임계값)
   - **낮은 상관관계**인 경우: 주요 메트릭 선택 필요

2. **RQ4**: 선택된 메트릭과 정렬된 비용 행렬 설계
   - **포인트-주요**인 경우: 비용 = Σ (포인트 단위 FP + 포인트 단위 FN × cost_ratio)
   - **이벤트-주요**인 경우: 비용 = Σ (이벤트 단위 FP + 이벤트 단위 FN × cost_ratio)

3. **RQ2**: 비용 제약 하에서 선택된 메트릭을 최적으로 최적화하는 앙상블 방법 선택
   - 평가: ECE (보정 품질) + 예상 비용 (주요 메트릭)

**예시**:
```
RQ3 결과: 상관관계 = 0.50 (약함) → 선택 필요

제조 도메인 분석: 이벤트 재현율이 중요
→ 주요 메트릭: Event F1

RQ4 비용 행렬: (0, 1, 15, 0) [높은 FN 페널티]
→ 이벤트 재현율 최적화 임계값

RQ2 앙상블 비교:
- 선형 (α=0.5): Event F1 = 0.72, ECE = 0.04, 비용 = 120
- 최대:            Event F1 = 0.78, ECE = 0.06, 비용 = 95  ← 승자
- 곱:            Event F1 = 0.68, ECE = 0.03, 비용 = 140

선택: 최대 앙상블 (더 나은 이벤트 재현율과 낮은 비용을 위해 보정을 약간 희생)
```

---

## 4. 실험 설계 함의

### 4.1 순차 vs 병렬 실행

**옵션 A: 순차** (초기 탐색에 권장)
1. 2주차: RQ1 답변 (특징 비교) → 주파수 지배 vs 시간 지배 데이터셋 식별
2. 3주차: RQ2 답변 (앙상블 방법) → RQ1 결과별로 계층화
3. 3주차: RQ3 답변 (메트릭 상관관계) → RQ2의 앙상블 방법별로
4. 4주차: RQ4 답변 (비용 민감성) → RQ2의 최상 앙상블 사용, RQ3 메트릭 선택 고려

**옵션 B: 병렬** (포괄적 분석을 위해)
- 전체 요인 설계로 모든 RQ 실험 실행:
  - RQ1: 2개 특징 도메인 × 3개 데이터셋
  - RQ2: 4개 앙상블 방법 × 3개 데이터셋
  - RQ3: (4개 앙상블 방법 × 3개 데이터셋) → 조합별 상관관계
  - RQ4: 5개 비용 비율 × 3개 데이터셋 × 4개 앙상블 방법
- **총**: ~180 실험 실행
- **시간**: 배치 스크립트로 ~1주

**권장사항**: 이해를 구축하기 위해 순차(옵션 A)로 시작, 최종 검증을 위해 옵션 B 사용.

---

### 4.2 보고 구조

**EXPERIMENT_REPORT.md**는 의존성을 반영해야:

```markdown
## Section 2: 연구 질문 답변

### RQ1: 주파수 vs 시간 특징 (기초)
- **결과**: SpecCNN이 SKAB에서 Rule 능가 (0.85 vs 0.65 AUC-PR, p<0.01)
- **RQ2에 대한 함의**: 앙상블이 SKAB에서 SpecCNN 선호해야

### RQ2: 앙상블 방법 (RQ1에 의존)
- **계층 분석**:
  - 주파수 지배 데이터셋 (SKAB): 곱 앙상블이 승리
  - 시간 지배 데이터셋 (AIHub): 선형 앙상블이 승리
- **RQ3에 대한 함의**: 데이터셋 유형별 별도 메트릭 분석 필요

### RQ3: Point vs Event 상관관계 (RQ2에 의존)
- **결과**: 상관관계 = 0.52 ± 0.08 (약함~중간)
- **RQ4에 대한 함의**: 비용 행렬이 제조에 대해 이벤트-주요여야

### RQ4: 비용 민감성 (RQ1-3 통합)
- **결과**: 고불균형 데이터셋(>1:50)에 최적 비용 비율 = 10× FN/FP
- **구성**: 곱 앙상블 + SpecCNN 중심 + 이벤트 최적화 임계값 사용
```

---

## 5. 상호연결성에 대한 이론적 정당화

### 5.1 파이프라인으로서의 탐지 (독립 단계 아님)

4개 RQ는 이상 탐지 파이프라인의 4단계에 대응:

```
원시 데이터 → 특징 추출 (RQ1) → 점수 융합 (RQ2) → 임계값 설정 (RQ4) → 평가 (RQ3)
              ↑                          ↑                       ↑                    ↑
           시간 vs 주파수          선형/곱/최대      비용 민감 τ*    Point vs Event
```

**이론적 주장**: 파이프라인에서 각 단계를 독립적으로 최적화하는 것은 공동 최적화보다 **최적이 아님** (Bishop, 2006, Pattern Recognition).

**증거**: RQ4 비용 행렬이 변경되면, 최적 임계값이 변경될 수 있고, 이것이 어떤 앙상블 방법(RQ2)이 최고인지 변경할 수 있고, 이것이 어떤 특징(RQ1)에 더 높은 가중치를 부여해야 하는지 변경할 수 있음.

---

### 5.2 다목적 최적화 프레임워크

4개 RQ는 실제로 단일 최적화 문제의 제약/목표:

**목적**: 예상 비용 최소화 (RQ4)

**제약 조건**:
- 특징 도메인 선택 (RQ1): `θ_features ∈ {time, freq, hybrid}`
- 앙상블 방법 (RQ2): `θ_ensemble ∈ {linear, product, max, learned}`
- 보정 품질 (RQ2): `ECE < 0.05`
- 메트릭 제약 (RQ3): `corr(F1_point, F1_event) < 0.6`이면, 주요 메트릭 선택

**해결책**: (예상 비용, ECE, 이벤트 재현율)의 파레토 프론티어

**인용**: 기계 학습에서의 다목적 최적화 (Jin & Sendhoff, 2008).

---

## 6. 실무자를 위한 실용적 가이드

### 6.1 탐지기 구성을 위한 의사결정 트리

```
시작: 새 제조 데이터셋

Step 1 (RQ1): 주파수 특성 분석
├─ 높은 주파수 분리 (PSD에 명확한 피크)?
│  → SpecCNN 중심 앙상블 사용 (α ≥ 0.7)
└─ 광대역 노이즈?
   → Rule 중심 앙상블 사용 (α ≤ 0.3)

Step 2 (RQ2): 앙상블 방법 선택
├─ 보정된 확률 필요 (다운스트림 결정을 위해)?
│  → 선형 또는 학습된 앙상블 사용 (더 나은 ECE)
└─ 이진 탐지만 필요?
   → 최대 또는 곱 사용 (더 나은 재현율)

Step 3 (RQ3): 주요 메트릭 선택
├─ 거짓 경보가 매우 비쌈?
│  → Point F1 주요
└─ 이벤트 놓침이 치명적?
   → Event F1 주요

Step 4 (RQ4): 비용 행렬 설정
├─ 불균형 > 1:50 AND Event 주요?
│  → C_FN/C_FP 비율 ≥ 10
├─ 불균형 < 1:20 AND Point 주요?
│  → C_FN/C_FP 비율 ≤ 5
└─ 그렇지 않으면: 비율 = 5로 시작, 검증으로 튜닝
```

---

## 7. 향후 작업을 위한 미해결 질문

### 7.1 미해결 의존성

- **RQ1 시간 의존성**: 장비가 노후화되면 최적 특징 도메인이 시간 경과에 따라 변경되는가? (개념 드리프트)
- **RQ4 지연 의존 비용**: 비용 행렬이 탐지 지연 포함해야 하는가? `C_FN(delay) = C_FN_base × (1 + β × delay)`

### 7.2 데이터셋별 vs 보편적 답변

- **보편적** 답변을 찾을 수 있는가 (예: "곱 앙상블이 항상 최고"), 아니면 모든 답변이 데이터셋별인가?
- 데이터셋별이면, 최적 구성을 예측하는 **메타 특징** (불균형, SNR, 주파수 특성)은 무엇인가?

**제안된 향후 RQ**: "데이터셋 프로파일링만으로 최적 (RQ1, RQ2, RQ4) 구성을 예측하는 메타 모델을 구축할 수 있는가?"

---

## 8. 요약 표

| RQ 쌍 | 의존성 강도 | 메커니즘 | 실험적 결과 |
|---------|---------------------|-----------|--------------------------|
| RQ1 → RQ2 | **강함** | 특징 도메인이 앙상블 가중치에 영향 | RQ1 결과별로 RQ2 계층화 |
| RQ2 → RQ3 | **중간** | 앙상블 방법이 메트릭 트레이드오프에 영향 | 앙상블별로 RQ3 보고 |
| RQ3 → RQ4 | **강함** | 메트릭 선택이 비용 설계에 영향 | RQ4가 RQ3의 메트릭 사용 |
| RQ4 → RQ1 | **중간** | 비용이 이상 유형 탐지에 의존 | 이상 유형별로 RQ4 계층화 |
| RQ1+RQ2+RQ4 | **매우 강함** | 모두 비용 최적 구성에 수렴 | 다른 것 없이 하나 답변 불가 |
| RQ2+RQ3+RQ4 | **강함** | 메트릭 인식 비용 최적화 | 공동 최적화 필요 |

---

## 참고문헌

1. Bishop, C. M. (2006). *Pattern Recognition and Machine Learning*. Springer.
2. Davis, J., & Goadrich, M. (2006). The relationship between Precision-Recall and ROC curves. *ICML*.
3. Galar, M., et al. (2011). A review on ensembles for the class imbalance problem. *IEEE TKDE*.
4. Jin, Y., & Sendhoff, B. (2008). Pareto-based multiobjective machine learning. *IEEE TNNLS*.
5. Lowell, D., et al. (2019). Practical obstacles to deploying active learning. *EMNLP*.
6. Wolpert, D. H. (1992). Stacked generalization. *Neural Networks*, 5(2), 241-259.

---

**버전 히스토리**:
- 1.0 (2025-10-01): TODO.md RQ1-RQ4 기반 초안
- 1.1 (2주차 계획): 예비 RQ1 결과로 업데이트
- 2.0 (5주차 계획): 모든 RQ 답변 및 경험적 의존성 확인으로 완성
